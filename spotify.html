<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hey its me Rama!</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: ui-sans-serif, system-ui; background-color: #000; color: #fff; }
        .player-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
        }
        .album-art {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .progress-bar-container {
            width: 100%;
            height: 4px;
            background-color: #535353;
            border-radius: 2px;
            margin-top: 1rem;
        }
        .progress-bar {
            height: 100%;
            background-color: #1ed760;
            width: 0;
            transition: width 0.5s ease-out;
        }
        .time-display {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 0.875rem;
            color: #b3b3b3;
            margin-top: 0.5rem;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-top: 1.5rem;
        }
        .controls svg {
            width: 2rem;
            height: 2rem;
            fill: #fff;
            cursor: default;
        }
        .controls .play-btn {
            width: 3.5rem;
            height: 3.5rem;
        }
        .logo {
            position: absolute;
            top: 2rem;
            left: 2rem;
            font-weight: bold;
            color: #1ed760;
        }
        .user-text {
            position: absolute;
            bottom: 2rem;
            text-align: center;
            font-size: 1rem;
            color: #b3b3b3;
        }
    </style>
</head>
<body>

    <div id="playerContainer" class="player-container">
        <h1 id="listeningText" class="text-lg text-green-500 mb-4 text-center">Loading...</h1>
        <img id="albumArt" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Album Art" class="album-art hidden">
        <div class="w-full">
            <h2 id="songTitle" class="text-2xl font-bold text-center mt-4 hidden"></h2>
            <p id="artistName" class="text-lg text-gray-400 text-center hidden"></p>
        </div>
        <div id="progressBarContainer" class="progress-bar-container hidden">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="timeDisplay" class="time-display hidden">
            <span id="currentTime">0:00</span>
            <span id="totalTime">0:00</span>
        </div>

        <div id="controls" class="controls hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6l-8.5 6z"></path></svg>
            <svg class="play-btn" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 6h2v12h-2zm-3.5 6-8.5 6V6l8.5 6z"></path></svg>
        </div>

        <a id="instagramLink" href="https://instagram.com/yaelahramalagi" target="_blank" rel="noopener noreferrer" 
           class="mt-8 flex items-center gap-2 text-gray-400 hover:text-white transition-colors duration-200 hidden">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
                <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
            </svg>
            <span>hit me up on instagram!</span>
        </a>
        
        <div id="connectButton" class="mt-8 hidden">
            <a href="/.netlify/functions/login-spotify" class="bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-200">
                Connect to Spotify
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    <script>
        const playerContainer = document.getElementById('playerContainer');
        const listeningText = document.getElementById('listeningText');
        const albumArt = document.getElementById('albumArt');
        const songTitle = document.getElementById('songTitle');
        const artistName = document.getElementById('artistName');
        const progressBar = document.getElementById('progressBar');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentTime = document.getElementById('currentTime');
        const totalTime = document.getElementById('totalTime');
        const connectButton = document.getElementById('connectButton');
        const controls = document.getElementById('controls');
        const instagramLink = document.getElementById('instagramLink'); // Ambil elemen link Instagram

        function formatTime(ms) {
            const seconds = Math.floor((ms / 1000) % 60);
            const minutes = Math.floor((ms / 1000 / 60) % 60);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        async function fetchNowPlaying() {
            const response = await fetch('/.netlify/functions/now-playing');
            const data = await response.json();

            if (data.error) {
                listeningText.textContent = 'Error: ' + data.error;
                connectButton.classList.remove('hidden');
                return;
            }

            if (data.isPlaying) {
                listeningText.textContent = `Rama is listening to a song right now:`;
                albumArt.src = data.albumArt;
                songTitle.textContent = data.title;
                artistName.textContent = data.artist;

                albumArt.classList.remove('hidden');
                songTitle.classList.remove('hidden');
                artistName.classList.remove('hidden');
                progressBarContainer.classList.remove('hidden');
                timeDisplay.classList.remove('hidden');
                controls.classList.remove('hidden');
                instagramLink.classList.remove('hidden'); // Tampilkan link Instagram

                const progressPercent = (data.progress / data.duration) * 100;
                progressBar.style.width = `${progressPercent}%`;
                currentTime.textContent = formatTime(data.progress);
                totalTime.textContent = formatTime(data.duration);
            } else {
                listeningText.textContent = 'Rama is not listening to a song right now.';
                albumArt.classList.add('hidden');
                songTitle.classList.add('hidden');
                artistName.classList.add('hidden');
                progressBarContainer.classList.add('hidden');
                timeDisplay.classList.add('hidden');
                controls.classList.add('hidden');
                instagramLink.classList.add('hidden'); // Sembunyikan link Instagram
            }
        }
        
        fetchNowPlaying();
        setInterval(fetchNowPlaying, 10000);
    </script>
</body>
</html>