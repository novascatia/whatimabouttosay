<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rama is Listening - Now Playing</title>
    <link rel="icon" type="image/png" href="/logo.png">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Variabel CSS: DARK MODE ðŸŒ™ */
        :root {
            --bg-color: #1a1a1a;
            --text-color: #f0f0f0;
            --primary-color: #4dc2ff; 
            --secondary-color: #b0b0b0; 
            --spotify-green: #1ed760;
            --card-bg: #282828;
            --shadow-dark: rgba(0, 0, 0, 0.8);
            --font-main: 'Poppins', sans-serif;
        }
        
        * {
            box-sizing: border-box; /* FIX: Mencegah scroll horizontal dari padding */
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            /* FIX: Menghilangkan scroll horizontal */
            overflow-x: hidden; 
        }

        .player-container {
            position: relative;
            width: 100%;
            max-width: 450px; 
            padding: 2rem;
            box-sizing: border-box;
            text-align: center;
            z-index: 10;
        }

        /* Efek Latar Belakang (Blur effect) */
        #albumArtBackground {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(80px) brightness(0.7);
            transform: scale(1.1);
            opacity: 0.4;
            transition: all 0.8s ease;
            z-index: 1;
        }
        
        /* Album Art Utama */
        .album-art {
            width: 100%;
            height: auto;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 15px 30px var(--shadow-dark);
            transition: transform 0.3s ease;
            max-width: 350px;
            object-fit: cover;
        }
        .album-art:hover {
            transform: scale(1.02);
        }

        /* Judul Lagu dan Artis */
        .song-title {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-color);
            margin: 0 0 5px 0;
            line-height: 1.2;
        }
        .artist-name {
            font-size: 1.1em;
            color: var(--secondary-color);
            margin: 0;
            font-weight: 400;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background-color: #404040;
            border-radius: 3px;
            margin-top: 2rem;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--spotify-green);
            width: 0;
        }
        .time-display {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 0.85rem;
            color: var(--secondary-color);
            margin-top: 0.5rem;
            font-weight: 500;
        }

        /* Kontrol */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-top: 2.5rem;
        }
        .controls i {
            font-size: 1.8rem;
            color: var(--secondary-color);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .controls i:hover {
            color: var(--text-color);
        }
        .controls .play-btn i {
            font-size: 3rem;
            color: var(--spotify-green);
        }
        .controls .play-btn i:hover {
            color: #1aae55;
        }
        
        /* Link Sosial & Koneksi */
        .social-links-container {
            margin-top: 4rem;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
            width: 100%;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--secondary-color);
            text-decoration: none;
            font-size: 0.95em;
            margin-bottom: 15px;
            transition: color 0.3s;
        }

        .social-link:hover {
            color: var(--primary-color);
        }
        
        .connect-button a {
            background-color: var(--spotify-green);
            color: var(--card-bg);
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
            transition: background-color 0.3s;
        }
        .connect-button a:hover {
            background-color: #1aae55;
        }
        
        .hidden { display: none !important; }

    </style>
</head>
<body>
    
    <div id="albumArtBackground"></div>

    <div id="playerContainer" class="player-container">
        
        <h1 id="listeningText" style="font-size:1.1em; color:var(--spotify-green); margin-bottom: 2rem;">Loading...</h1>
        
        <img id="albumArt" src="" alt="Album Art" class="album-art hidden">
        
        <div class="w-full">
            <h2 id="songTitle" class="song-title hidden"></h2>
            <p id="artistName" class="artist-name hidden"></p>
        </div>
        
        <div id="progressBarContainer" class="progress-bar-container hidden">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="timeDisplay" class="time-display hidden">
            <span id="currentTime">0:00</span>
            <span id="totalTime">0:00</span>
        </div>

        <div id="controls" class="controls hidden">
            <i class="fas fa-backward"></i>
            <span class="play-btn">
                <i id="playPauseIcon" class="fas fa-pause"></i>
            </span>
            <i class="fas fa-forward"></i>
            </div>

        <div class="social-links-container">
            <a id="spotifyLink" href="https://open.spotify.com/user/312em4jgpxct27qoj7vfu3z2xqei?si=2238a3ccbb1545a2" target="_blank" rel="noopener noreferrer" 
               class="social-link hidden">
                <i class="fab fa-spotify"></i>
                <span>Follow my Spotify!</span>
            </a>
            
            <a id="instagramLink" href="https://instagram.com/grayalldayog" target="_blank" rel="noopener noreferrer" 
               class="social-link hidden">
                <i class="fab fa-instagram"></i>
                <span>Hit me up on Instagram!</span>
            </a>

            <div id="connectButton" class="connect-button hidden">
                <a href="/.netlify/functions/login-spotify">
                    Connect to Spotify
                </a>
            </div>
        </div>
        
    </div>

    <script>
        const listeningText = document.getElementById('listeningText');
        const albumArt = document.getElementById('albumArt');
        const albumArtBackground = document.getElementById('albumArtBackground');
        const songTitle = document.getElementById('songTitle');
        const artistName = document.getElementById('artistName');
        const progressBar = document.getElementById('progressBar');
        const currentTimeElement = document.getElementById('currentTime');
        const totalTimeElement = document.getElementById('totalTime');
        const playPauseIcon = document.getElementById('playPauseIcon');

        // Menghilangkan variabel lirik
        
        function formatTime(ms) {
            const seconds = Math.floor((ms / 1000) % 60);
            const minutes = Math.floor((ms / 1000 / 60) % 60);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function showElements(show) {
            // Logika tampilan player utama
            const elementsToToggle = [
                albumArt, songTitle, artistName, progressBarContainer, timeDisplay, 
                controls, spotifyLink, instagramLink
            ];
            elementsToToggle.forEach(el => el.classList.toggle('hidden', !show));
        }

        async function fetchNowPlaying() {
            const response = await fetch('/.netlify/functions/now-playing');
            const data = await response.json();

            if (data.error) {
                // ... Error handling
                return;
            }
            
            if (data.isPlaying) {
                // Data lirik tidak lagi disimpan
                
                // Update UI elements
                albumArt.src = data.albumArt;
                albumArtBackground.style.backgroundImage = `url('${data.albumArt}')`;
                songTitle.textContent = data.title;
                artistName.textContent = data.artist;

                // Progress Bar Update
                const currentProgressMs = data.progress;
                const durationMs = data.duration;

                totalTimeElement.textContent = formatTime(durationMs);
                currentTimeElement.textContent = formatTime(currentProgressMs);
                
                const progressPercent = (currentProgressMs / durationMs) * 100;
                progressBar.style.width = `${progressPercent}%`;

                // Update Link Judul Lagu
                songTitle.onclick = () => window.open(data.songUrl, '_blank');
                
                // Tampilkan ikon Play/Pause yang benar
                playPauseIcon.className = data.is_playing ? 'fas fa-pause' : 'fas fa-play';

                showElements(true);
                
            } else {
                // Lagu tidak diputar
                showElements(false);
            }
        }
        
        fetchNowPlaying();
        setInterval(fetchNowPlaying, 1000); 
    </script>
</body>
</html>
